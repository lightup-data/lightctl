#!/usr/bin/env python3

import logging

import click

from lightctl.command import (
    metric_command,
    rule_command,
    source_command,
    version_command,
)
from lightctl.command.common import ContextObject
from lightctl.util import CliPrinter, FileLoader

CONTEXT_SETTINGS = dict(help_option_names=["-h", "--help"])


help_message = """ You can override default setting by setting following environment variable
LIGHTUP_URL_BASE

Examples:\n
$ python3 ./lightctl rule list\n
$ python3 ./lightctl rule get 2d975f53-c124-4c08-b130-85a141ca7ba5\n

$ LIGHTUP_URL_BASE=https://app.demo.lightup.ai python3 ./lightctl rule list\n
"""


@click.group(context_settings=CONTEXT_SETTINGS, help=help_message)
@click.option("--debug", default=False, is_flag=True)
@click.option("--json", default=False, is_flag=True)
@click.pass_context
def cli(ctx, debug, json):
    ctx.obj = ContextObject(
        printer=CliPrinter(use_json_format=json),
        file_loader=FileLoader(use_json_format=json),
    )
    if debug:
        logging.basicConfig(level=logging.DEBUG)
    else:
        logging.basicConfig(level=logging.INFO)


cli.add_command(version_command.version)
cli.add_command(source_command.source)
cli.add_command(metric_command.metric)
cli.add_command(rule_command.rule)


if __name__ == "__main__":
    cli()
